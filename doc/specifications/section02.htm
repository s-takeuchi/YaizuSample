<!DOCTYPE html>

<html lang="ja">

<HEAD>
<title>CmdFreak</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="./style.css" type="text/css">
</HEAD>

<BODY>
<div id="container">
<H1>2. 内部処理</H1>

<H2 ID="2.1">2.1 REST API仕様</H2>
<div class="topic">
CmdFreakのREST APIは，以下の一覧に示すAPIをクライアント提供します。
<table class="tblstyle">
<tr><td>GET /api/server/</td><td>Acquires server information of YaizuSample.</td></tr>
<tr><td>POST /api/server/</td><td>Configure server information.</td></tr>
<tr><td>GET /api/command/</td><td>Get command information</td></tr>
<tr><td>POST /api/command/</td><td>Configure command information</td></tr>
<tr><td>DELETE /api/command/n/</td><td>Delete command information</td></tr>
<tr><td>GET /api/statuscommand/x/</td><td>Get command information for status acquisition</td></tr>
<tr><td>GET /api/opcommand/x/</td><td>Get command information for operation</td></tr>
<tr><td>GET /api/agent/</td><td>Get agent information</td></tr>
<tr><td>POST /api/agent/</td><td>Register/update agent information</td></tr>
<tr><td>GET /api/file/x/n/</td><td>Get file</td></tr>
<tr><td>POST /api/file/</td><td>Store file</td></tr>
</table>
</div><p>


<H2 ID="2.2">2.2 共通エラー</H2>
<div class="topic">
特定のAPIに依存せず共通で発生し得るエラーは以下の3種類です。<br/>
<table class="tblstyle">
<tr><th>ステータスコード</th><th>レスポンスコード</th><th>説明</th></tr>
<tr><td>404</td><td>1001</td><td>クライアントからのリクエストに対応するAPIが定義されていない。</td></tr>
<tr><td>400</td><td>1002</td><td>リクエストがJSONではないデータを含んでいるかHTTPヘッダのContent-Typeがapplication/jsonではない。</td></tr>
<tr><td>400</td><td>1005</td><td>リクエストが壊れている。</td></tr>
</table><p>
上記のエラーは以下のレスポンスで返却されます。<br/>

<ul>
<li>レスポンス
<pre>
{
  "Code" : 1234,
  "MsgEng" : "abc",
  "MsgJpn" : "あいう",
}
</pre>
<table class="tblstyle">
<tr><td>Code</td><td>Integer</td><td>結果コード。1001(HTTPステータスコード=404)，1002(HTTPステータスコード=400)，1005(HTTPステータスコード=400)。</td></tr>
<tr><td>MsgEng</td><td>String</td><td>英文メッセージ。結果コードが0のときは空文字が返る。</td></tr>
<tr><td>MsgJpn</td><td>String</td><td>和文メッセージ。結果コードが0のときは空文字が返る。</td></tr>
</table><br/>
</li>
</ul>
</div><p>


<H2 ID="2.3">2.3 GET /api/server/</H2>
<div class="topic">
Acquires server information of YaizuSample.<br/>
<ul>
<li>Request
<p>nothing</p>
</li>
<li>Response
<pre>
{
  "Code" : 1234,
  "MsgEng" : "abc",
  "MsgJpn" : "あいう",
  "Data" : {
    "ServerInfo" : {
        "StartTimeUtc" : "2021-01-31T04:56:22+00:00",
        "StartTimeLocal" : "2021-01-31T04:56:22+00:00",
        "Version" : "1.0.0",
        "PollingInterval" : 30,
        "StatusAcquisitionInterval" : 300
    }
  }
}
</pre>
<table class="tblstyle">
<tr><td>Code</td><td>Integer</td><td>Result code. 0:success(HTTP status code=200)，4206:Authorization error(HTTP status code=401)</td></tr>
<tr><td>MsgEng</td><td>String</td><td>English message. Empty string is returned when result code is 0.</td></tr>
<tr><td>MsgJpn</td><td>String</td><td>Japanese message. Empty string is returned when result code is 0.</td></tr>
<tr><td>Data</td><td>Element</td><td>Not returned when result code is not zero.</td></tr>
<tr><td>ServerInfo</td><td>Element</td><td></td></tr>
<tr><td>StartTimeUtc</td><td>String</td><td>Service start date and time in UTC</td></tr>
<tr><td>StartTimeLocal</td><td>String</td><td>Service start date and time in localtime</td></tr>
<tr><td>Version</td><td>String</td><td>Server version number</td></tr>
<tr><td>PollingInterval</td><td>Integer</td><td>Polling interval in second from agent to server</td></tr>
<tr><td>StatusAcquisitionInterval</td><td>Integer</td><td>Status acquisition interval in second</td></tr>
</table><br/>
</li>
</ul>
</div><p>


<H2 ID="2.4">2.4 POST /api/server/</H2>
<div class="topic">
Configure server information.<br/>
<ul>
<li>Request
<pre>
{
  "PollingInterval" : 60,
  "StatusAcquisitionInterval" : 30
}
</pre>
<table class="tblstyle">
<tr><td>PollingInterval</td><td>Integer</td><td>Polling interval in second from agent to server</td></tr>
<tr><td>StatusAcquisitionInterval</td><td>Integer</td><td>Status acquisition interval in second</td></tr>
</table><br/>
</li>
<li>Response
<pre>
{
  "Code" : 1234,
  "MsgEng" : "abc",
  "MsgJpn" : "あいう",
}
</pre>
<table class="tblstyle">
<tr><td>Code</td><td>Integer</td><td>Result code. 
                                     0:success(HTTP status code=200)
                                     4206:Authorization error(HTTP status code=401),
                                     4204:Access Right error(HTTP status code=403),
                                     4203:No request specified(HTTP status code=400),
                                     4041:No polling interval is specified(HTTP status code=400),
                                     4042:No status acquisition inverval is specified(HTTP status code=400),
                                     4043:The specified polling interval is invalid(HTTP status code=400),
                                     4044:The specified status acquisition interval is invalid(HTTP status code=400)
</td></tr>
<tr><td>MsgEng</td><td>String</td><td>English message. Empty string is returned when result code is 0.</td></tr>
<tr><td>MsgJpn</td><td>String</td><td>Japanese message. Empty string is returned when result code is 0.</td></tr>
</table><br/>
</li>
</ul>
</div><p>


<H2 ID="2.5">2.5 GET /api/command/</H2>
<div class="topic">
Get command information. All of commands are acquired.<br/>
<ul>
<li>Request
<p>nothing</p>
</li>
<li>Response
<pre>
{
  "Code" : 1234,
  "MsgEng" : "abc",
  "MsgJpn" : "あいう",
  "Data" : {
    "Command" : [
      {
        "Id" : 1,
        "Name" : "Command name",
        "Type" : 0,
        "Script" : "echo hello!!",
        "ServerFileName" : "aaa.dat",
        "AgentFileName" : "bbb.dat"
      }
    ]
  }
}
</pre>
<table class="tblstyle">
<tr><td>Code</td><td>Integer</td><td>Result code. 0:success(HTTP status code=200)，4206:Authorization error(HTTP status code=401)</td></tr>
<tr><td>MsgEng</td><td>String</td><td>English message. Empty string is returned when result code is 0.</td></tr>
<tr><td>MsgJpn</td><td>String</td><td>Japanese message. Empty string is returned when result code is 0.</td></tr>
<tr><td>Data</td><td>Element</td><td>Not returned when result code is not zero.</td></tr>
<tr><td>Command</td><td>Element</td><td></td></tr>
<tr><td>Id</td><td>Integer</td><td>Command ID</td></tr>
<tr><td>Name</td><td>String</td><td>Command name</td></tr>
<tr><td>Type</td><td>Integer</td><td>0: Linux, 1:Windows</td></tr>
<tr><td>Script</td><td>String</td><td>Command script</td></tr>
<tr><td>ServerFileName</td><td>String</td><td>File name (not path) copied to agent.</td></tr>
<tr><td>AgentFileName</td><td>String</td><td>File name (not path) copied to server.</td></tr>
</table><br/>
</li>
</ul>
</div><p>


<H2 ID="2.6">2.6 POST /api/command/</H2>
<div class="topic">
Configure command information.<br/>
<ul>
<li>Request
<pre>
{
  "Id" : 1,
  "Name" : "Command name",
  "Type" : 0,
  "Script" : "echo hello!!",
  "ServerFileName" : "aaa.dat",
  "AgentFileName" : "bbb.dat"
}
</pre>
<table class="tblstyle">
<tr><td>Id</td><td>Integer</td><td>Specify command ID if you want to edit existing command. Do not specify if you want to create new command.</td></tr>
<tr><td>Name</td><td>String</td><td>Command name</td></tr>
<tr><td>Type</td><td>Integer</td><td>0: Linux, 1:Windows</td></tr>
<tr><td>Script</td><td>String</td><td>Command script</td></tr>
<tr><td>ServerFileName</td><td>String</td><td>File name (not path) copied to agent.</td></tr>
<tr><td>AgentFileName</td><td>String</td><td>File name (not path) copied to server.</td></tr>
</table><br/>
</li>
<li>Response
<pre>
{
  "Code" : 1234,
  "MsgEng" : "abc",
  "MsgJpn" : "あいう",
}
</pre>
<table class="tblstyle">
<tr><td>Code</td><td>Integer</td><td>Result code
                                     0:success(HTTP status code=200),
                                     4206:Authorization error(HTTP status code=401),
                                     4204:Access Right error(HTTP status code=403),
                                     4203:No request specified(HTTP status code=400),
                                     4024:Length of command name is invalid(HTTP status code=400),
                                     4025:Length of script is invalid(HTTP status code=400),
                                     4026:Length of file name is invalid(HTTP status code=400),
                                     4027:Forbidden character is specified in file name(HTTP status code=400),
                                     4028:Duplicated command name is specified(HTTP status code=400),
                                     4020:Specified command ID does not exist(HTTP status code=400),
                                     4023:Command name is not presented(HTTP status code=400),
</td></tr>
<tr><td>MsgEng</td><td>String</td><td>English message. Empty string is returned when result code is 0.</td></tr>
<tr><td>MsgJpn</td><td>String</td><td>Japanese message. Empty string is returned when result code is 0.</td></tr>
</table><br/>
</li>
</ul>
</div><p>


<H2 ID="2.7">2.7 DELETE /api/command/n/</H2>
<div class="topic">
Delete command information.<br/>
<ul>
<li>Request
<p>n in URL means ID of command which you want to delete.</p>
</li>
<li>Response
<pre>
{
  "Code" : 1234,
  "MsgEng" : "abc",
  "MsgJpn" : "あいう",
}
</pre>
<table class="tblstyle">
<tr><td>Code</td><td>Integer</td><td>Result code
                                     0:success(HTTP status code=200),
                                     4206:Authorization error(HTTP status code=401),
                                     4204:Access Right error(HTTP status code=403),
                                     4020:Specified command ID does not exist(HTTP status code=400)
</td></tr>
<tr><td>MsgEng</td><td>String</td><td>English message. Empty string is returned when result code is 0.</td></tr>
<tr><td>MsgJpn</td><td>String</td><td>Japanese message. Empty string is returned when result code is 0.</td></tr>
</table><br/>
</li>
</ul>
</div><p>


<H2 ID="2.8">2.8 GET /api/statuscommand/x/</H2>
<div class="topic">
Get command information for status acquisition<br/>
<ul>
<li>Request
<p>x in URL means name of the agent which calls this API.</p>
</li>
<li>Response
<pre>
{
  "Code" : 1234,
  "MsgEng" : "abc",
  "MsgJpn" : "あいう",
  "Data" : {
    "Status" : "Execution",
    "Command" : {
      "Id" : 1,
      "Name" : "Command name",
      "Type" : 0,
      "Script" : "echo hello!!",
      "ServerFileName" : "aaa.dat",
      "ServerFileSize" : 65535,
      "AgentFileName" : "bbb.dat"
    }
  }
}
</pre>
<table class="tblstyle">
<tr><td>Code</td><td>Integer</td><td>Result code
                                     0:success(HTTP status code=200),
                                     4060:Target agent does not exist(HTTP status code=400)
</td></tr>
<tr><td>MsgEng</td><td>String</td><td>English message. Empty string is returned when result code is 0.</td></tr>
<tr><td>MsgJpn</td><td>String</td><td>Japanese message. Empty string is returned when result code is 0.</td></tr>
<tr><td>Data</td><td>Element</td><td>Not returned when result code is not zero.</td></tr>
<tr><td>Status</td><td>String</td><td>"Timeout" : Server detected timeout, "Execution" : Status command can be executed.</td></tr>
<tr><td>Command</td><td>Element</td><td>When "Status" is "Timeout", this element is not returned.</td></tr>
<tr><td>Id</td><td>Integer</td><td>Command ID</td></tr>
<tr><td>Name</td><td>String</td><td>Command name</td></tr>
<tr><td>Type</td><td>Integer</td><td>0: Linux, 1:Windows</td></tr>
<tr><td>Script</td><td>String</td><td>Command script</td></tr>
<tr><td>ServerFileName</td><td>String</td><td>File name (not path) copied to agent.</td></tr>
<tr><td>ServerFileSize</td><td>Integer</td><td>File size of the specified file name as "ServerFileName".</td></tr>
<tr><td>AgentFileName</td><td>String</td><td>File name (not path) copied to server.</td></tr>
</table><br/>
</li>
</ul>
</div><p>


<H2 ID="2.9">2.9 GET /api/opcommand/x/</H2>
<div class="topic">
Get command information for operation<br/>
<ul>
<li>Request
<p>x in URL means name of the agent which calls this API.</p>
</li>
<li>Response
<pre>
{
  "Code" : 1234,
  "MsgEng" : "abc",
  "MsgJpn" : "あいう",
  "Data" : {
    "Status" : "Execution",
    "Command" : {
      "Id" : 1,
      "Name" : "Command name",
      "Type" : 0,
      "Script" : "echo hello!!",
      "ServerFileName" : "aaa.dat",
      "ServerFileSize" : 65535,
      "AgentFileName" : "bbb.dat"
    }
  }
}
</pre>
<table class="tblstyle">
<tr><td>Code</td><td>Integer</td><td>Result code
                                     0:success(HTTP status code=200),
                                     4060:Target agent does not exist(HTTP status code=400)
</td></tr>
<tr><td>MsgEng</td><td>String</td><td>English message. Empty string is returned when result code is 0.</td></tr>
<tr><td>MsgJpn</td><td>String</td><td>Japanese message. Empty string is returned when result code is 0.</td></tr>
<tr><td>Data</td><td>Element</td><td>Not returned when result code is not zero.</td></tr>
<tr><td>Status</td><td>String</td><td>"Execution" is always returned.</td></tr>
<tr><td>Command</td><td>Element</td><td></td></tr>
<tr><td>Id</td><td>Integer</td><td>Command ID</td></tr>
<tr><td>Name</td><td>String</td><td>Command name</td></tr>
<tr><td>Type</td><td>Integer</td><td>0: Linux, 1:Windows</td></tr>
<tr><td>Script</td><td>String</td><td>Command script</td></tr>
<tr><td>ServerFileName</td><td>String</td><td>File name (not path) copied to agent.</td></tr>
<tr><td>ServerFileSize</td><td>Integer</td><td>File size of the specified file name as "ServerFileName".</td></tr>
<tr><td>AgentFileName</td><td>String</td><td>File name (not path) copied to server.</td></tr>
</table><br/>
</li>
</ul>
</div><p>


<H2 ID="2.10">2.10 GET /api/agent/</H2>
<div class="topic">
Get agent information. All of agents are acquired.<br/>
<ul>
<li>Request
<p>nothing</p>
</li>
<li>Response
<pre>
{
  "Code" : 1234,
  "MsgEng" : "abc",
  "MsgJpn" : "あいう",
  "Data" : {
    "AgentInfo" : [
      {
        "Name" : "Agent name",
        "Status" : 0,
        "StatusCmd" :0,
        "OpStatus" : 0,
        "OpCmd" : 0,
        "TimeUtc" : "2021-02-06T12:55:00+00:00",
        "TimeLocal" : "2021-02-06T12:55:00+09:00",
        "UdTimeUtc" : "2021-02-06T12:55:00+00:00",
        "UdTimeLocal" : "2021-02-06T12:55:00+09:00"
      }
    ]
  }
}
</pre>
<table class="tblstyle">
<tr><td>Code</td><td>Integer</td><td>Result code
                                     0:success(HTTP status code=200),
                                     4060:Target agent does not exist(HTTP status code=400)
</td></tr>
<tr><td>MsgEng</td><td>String</td><td>English message. Empty string is returned when result code is 0.</td></tr>
<tr><td>MsgJpn</td><td>String</td><td>Japanese message. Empty string is returned when result code is 0.</td></tr>
<tr><td>Data</td><td>Element</td><td>Not returned when result code is not zero.</td></tr>
<tr><td>AgentInfo</td><td>Element</td><td></td></tr>
<tr><td>Name</td><td>String</td><td>Agent name</td></tr>
<tr><td>Status</td><td>Integer</td><td>A status of command execution</td></tr>
<tr><td>StatusCmd</td><td>Integer</td><td>ID of status acquisition command</td></tr>
<tr><td>OpStatus</td><td>Integer</td><td>A status of command execution for operation</td></tr>
<tr><td>OpCmd</td><td>Integer</td><td>ID of status operation command</td></tr>
<tr><td>TimeUtc</td><td>String</td><td>Acquired time in UTC</td></tr>
<tr><td>TimeLocal</td><td>String</td><td>Acquired time in local</td></tr>
<tr><td>UdTimeUtc</td><td>String</td><td>Updated time in UTC</td></tr>
<tr><td>UdTimeLocal</td><td>String</td><td>Updated time in local</td></tr>
</table><br/>
</li>
</ul>
</div><p>


<H2 ID="2.11">2.11 POST /api/agent/</H2>
<div class="topic">
Register/update agent information.<br/>
<ul>
<li>Request<br/>
<u>In case of status update</u>
<pre>
{
  "Name" : "enable",
  "Status" : 0,
  "StatusTimeUtc" : "2021-02-06T12:55:00+00:00",
  "StatusTimeLocal" : "2021-02-06T12:55:00+09:00",
}
</pre>
<table class="tblstyle">
<tr><td>Name</td><td>String</td><td>Agent name</td></tr>
<tr><td>Status</td><td>Integer</td><td>A status of command execution</td></tr>
<tr><td>StatusTimeUtc</td><td>String</td><td>Acquired time in UTC</td></tr>
<tr><td>StatusTimeLocal</td><td>String</td><td>Acquired time in local</td></tr>
</table><br/>
<u>In case of operation status update</u>
<pre>
{
  "Name" : "enable",
  "OpStatus" : 0,
}
</pre>
<table class="tblstyle">
<tr><td>Name</td><td>String</td><td>Agent name</td></tr>
<tr><td>OpStatus</td><td>Integer</td><td>A status of command execution</td></tr>
</table><br/>
</li>
<li>Response
<pre>
{
  "Code" : 1234,
  "MsgEng" : "abc",
  "MsgJpn" : "あいう",
}
</pre>
<table class="tblstyle">
<tr><td>Code</td><td>Integer</td><td>Result code
                                     0:success(HTTP status code=200),
                                     4203:No request specified(HTTP status code=400),
                                     4205:Fobidden character is specified in host name(HTTP status code=400),
                                     4201:Name element does not exist(HTTP status code=400)
</td></tr>
<tr><td>MsgEng</td><td>String</td><td>English message. Empty string is returned when result code is 0.</td></tr>
<tr><td>MsgJpn</td><td>String</td><td>Japanese message. Empty string is returned when result code is 0.</td></tr>
</table><br/>
</li>
</ul>
</div><p>


<H2 ID="2.12">2.12 GET /api/file/x/n</H2>
<div class="topic">
Get file.<br/>
<ul>
<li>Request
<p>
x in URL means file name which you want to get.<br/>
n in URL means offset of file to be read.<br/>
</p>
</li>
<li>Response
<pre>
{
  "Code" : 1234,
  "MsgEng" : "abc",
  "MsgJpn" : "あいう",
  "Data" : {
    "FileData" : "00FF00FF00FF00FF"
  }
}
</pre>
<table class="tblstyle">
<tr><td>Code</td><td>Integer</td><td>Result code
                                     0:success(HTTP status code=200),
                                     4080:The target file does not exist(HTTP status code=400),
                                     4081:The file size exceeds the presented file size(HTTP status code=400)
</td></tr>
<tr><td>MsgEng</td><td>String</td><td>English message. Empty string is returned when result code is 0.</td></tr>
<tr><td>MsgJpn</td><td>String</td><td>Japanese message. Empty string is returned when result code is 0.</td></tr>
<tr><td>Data</td><td>Element</td><td>Not returned when result code is not zero.</td></tr>
<tr><td>FileData</td><td>String</td><td>File data</td></tr>
</table><br/>
</li>
</ul>
</div><p>


<H2 ID="2.13">2.13 POST /api/file/</H2>
<div class="topic">
Store file.<br/>
<ul>
<li>Request
<pre>
{
  "FileOffset" : 0,
  "FileData" : "aaa",
  "FileName" : "xxx"
}
</pre>
<table class="tblstyle">
<tr><td>FileOffset</td><td>Integer</td><td>offset of file to be read.</td></tr>
<tr><td>FileData</td><td>String</td><td>File data</td></tr>
<tr><td>FileName</td><td>String</td><td>File name</td></tr>
</table><br/>
</li>
<li>Response
<pre>
{
  "Code" : 1234,
  "MsgEng" : "abc",
  "MsgJpn" : "あいう",
}
</pre>
<table class="tblstyle">
<tr><td>Code</td><td>Integer</td><td>Result code 0:success(HTTP status code=200)</td></tr>
<tr><td>MsgEng</td><td>String</td><td>English message. Empty string is returned when result code is 0.</td></tr>
<tr><td>MsgJpn</td><td>String</td><td>Japanese message. Empty string is returned when result code is 0.</td></tr>
</table><br/>
</li>
</ul>
</div><p>


</div>
</BODY>

</html>

